<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Department Functionality Test Runner</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
        }
        .test-section h2 {
            color: #2c3e50;
            margin-top: 0;
        }
        .test-section h3 {
            color: #34495e;
            margin-bottom: 15px;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: background 0.3s;
        }
        button:hover {
            background: #2980b9;
        }
        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }
        .status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
        }
        .status.pending {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .status.running {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .console-output {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-top: 15px;
        }
        .config-info {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .config-info h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        .config-info p {
            margin: 5px 0;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Department Functionality Test Runner</h1>
        
        <div class="config-info">
            <h3>üìã Current Configuration</h3>
            <p><strong>Enterprise ID:</strong> x-spark-test</p>
            <p><strong>API Base URL:</strong> http://localhost:8383</p>
            <p><strong>Token Status:</strong> <span id="tokenStatus">Checking...</span></p>
        </div>

        <div class="test-section">
            <h2>üß™ Quick Test (Recommended First)</h2>
            <p>Tests the exact 4 requests made by your Department.tsx component</p>
            <button id="quickTestBtn" onclick="runQuickTest()">Run Quick Test</button>
            <div id="quickTestStatus" class="status pending">Click "Run Quick Test" to start</div>
            <div id="quickTestOutput" class="console-output" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h2>üß™ Comprehensive Test</h2>
            <p>Full CRUD operations, employee management, and complete workflow testing</p>
            <button id="comprehensiveTestBtn" onclick="runComprehensiveTest()">Run Comprehensive Test</button>
            <div id="comprehensiveTestStatus" class="status pending">Click "Run Comprehensive Test" to start</div>
            <div id="comprehensiveTestOutput" class="console-output" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h2>üîß Manual Test</h2>
            <p>Test individual endpoints manually</p>
            <button onclick="testGetDepartments()">Test Get Departments</button>
            <button onclick="testGetCards()">Test Get Cards</button>
            <button onclick="testCreateDepartment()">Test Create Department</button>
            <button onclick="testDeleteDepartment()">Test Delete Department</button>
            <button onclick="listAllDepartments()">List Department IDs</button>
            <button onclick="listEmployeesInDepartment()">List Employees in Department</button>
            <button onclick="removeAllEmployeesFromDepartment()">Remove All Employees from Department</button>
            <button onclick="testEmployeeFix()">Test Employee Fix</button>
            <button onclick="unassignAllEmployeesFromDepartment()">Unassign All Employees from Department</button>
            <div id="manualTestOutput" class="console-output" style="display: none;"></div>
        </div>
    </div>

    <script>
        // Configuration from api.ts
        const FIREBASE_TOKEN = "eyJhbGciOiJSUzI1NiIsImtpZCI6IjZkZTQwZjA0ODgxYzZhMDE2MTFlYjI4NGE0Yzk1YTI1MWU5MTEyNTAiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20veHNjYXJkLWFkZGQ0IiwiYXVkIjoieHNjYXJkLWFkZGQ0IiwiYXV0aF90aW1lIjoxNzUzNDQ0NDk5LCJ1c2VyX2lkIjoiRWNjeU1Ddjd1aVMxZVlIQjNaTXU2elJSMURHMiIsInN1YiI6IkVjY3lNQ3Y3dWlTMWVZSEIzWk11NnpSUjFERzIiLCJpYXQiOjE3NTM0NDQ0OTksImV4cCI6MTc1MzQ0ODA5OSwiZW1haWwiOiJ0ZXN0ZWhha2tlQGd1ZnVtLmNvbSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJmaXJlYmFzZSI6eyJpZGVudGl0aWVzIjp7ImVtYWlsIjpbInRlc3RlaGFra2VAZ3VmdW0uY29tIl19LCJzaWduX2luX3Byb3ZpZGVyIjoicGFzc3dvcmQifX0.ZmbRr2VofWRQufCr2XBg5A6kywtqklYm3cVpIJMOUtDD00YpubKlKrIz4N3mX62lzMc2MlCZGWlH_f-gaA1GZPRkEaRSwkL90xbnuk-pjzuac0E6yAtsnacxzUXUX-YfyfQxgWq7Qe6Fv59R-2foeK-ZwmLOVxycXC6xtvOX1CP-GGaaKweiL7wxgC_hGmVBxxta7oKpWgKfkh90EfUGkxSfPzgdquqWBeXg9rnaI2UWKPiOxEBAaACiNG3Qd66zSjKidJAEm73YpPpYOm0qhfPzaBqvpWVy8Cer_DpuIbdS9Khc_VYs3S5c6GivM14qePGN79HcJUZD3lLFUN1KaA";
        const ENTERPRISE_ID = "x-spark-test";
        const API_BASE_URL = "http://localhost:8383";

        // Check token status on load
        window.onload = function() {
            const tokenStatus = document.getElementById('tokenStatus');
            if (FIREBASE_TOKEN && FIREBASE_TOKEN.length > 100) {
                tokenStatus.textContent = "‚úÖ Valid Token";
                tokenStatus.style.color = "green";
            } else {
                tokenStatus.textContent = "‚ùå Invalid Token";
                tokenStatus.style.color = "red";
            }
        };

        // Console capture
        let originalConsoleLog = console.log;
        let originalConsoleError = console.error;

        function captureConsole(outputElement) {
            const logs = [];
            
            console.log = function(...args) {
                const message = args.map(arg => 
                    typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
                ).join(' ');
                logs.push(`[LOG] ${message}`);
                outputElement.textContent = logs.join('\n');
                outputElement.scrollTop = outputElement.scrollHeight;
                originalConsoleLog.apply(console, args);
            };

            console.error = function(...args) {
                const message = args.map(arg => 
                    typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
                ).join(' ');
                logs.push(`[ERROR] ${message}`);
                outputElement.textContent = logs.join('\n');
                outputElement.scrollTop = outputElement.scrollHeight;
                originalConsoleError.apply(console, args);
            };

            return function() {
                console.log = originalConsoleLog;
                console.error = originalConsoleError;
            };
        }

        // Quick Test
        async function runQuickTest() {
            const statusEl = document.getElementById('quickTestStatus');
            const outputEl = document.getElementById('quickTestOutput');
            const btn = document.getElementById('quickTestBtn');

            statusEl.className = 'status running';
            statusEl.textContent = 'üîÑ Running Quick Test...';
            outputEl.style.display = 'block';
            outputEl.textContent = '';
            btn.disabled = true;

            const restoreConsole = captureConsole(outputEl);

            try {
                console.log('üöÄ Quick Department Component Test');
                console.log(`üè¢ Enterprise: ${ENTERPRISE_ID}`);
                console.log(`üåê API: ${API_BASE_URL}\n`);

                const headers = {
                    'Authorization': `Bearer ${FIREBASE_TOKEN}`,
                    'Content-Type': 'application/json'
                };

                // Test 1: Get Departments
                console.log('1Ô∏è‚É£ Testing Department.tsx useEffect() - Get Departments');
                try {
                    const deptUrl = `${API_BASE_URL}/enterprise/${ENTERPRISE_ID}/departments`;
                    console.log(`   ‚Üí ${deptUrl}`);
                    
                    const deptResponse = await fetch(deptUrl, { headers });
                    const deptData = await deptResponse.json();
                    
                    console.log(`   ‚úÖ Status: ${deptResponse.status}`);
                    console.log(`   üìä Departments: ${deptData.departments ? deptData.departments.length : 0}`);
                    console.log(`   üìù Sample:`, deptData.departments?.[0]?.name || 'None');
                } catch (error) {
                    console.log(`   ‚ùå Error: ${error.message}`);
                }

                // Test 2: Get Cards
                console.log('\n2Ô∏è‚É£ Testing Department.tsx useEffect() - Get Cards');
                try {
                    const cardsUrl = `${API_BASE_URL}/enterprise/${ENTERPRISE_ID}/cards`;
                    console.log(`   ‚Üí ${cardsUrl}`);
                    
                    const cardsResponse = await fetch(cardsUrl, { headers });
                    const cardsData = await cardsResponse.json();
                    
                    console.log(`   ‚úÖ Status: ${cardsResponse.status}`);
                    console.log(`   üìä Cards: ${cardsData.cards ? Object.keys(cardsData.cards).length : 0}`);
                } catch (error) {
                    console.log(`   ‚ùå Error: ${error.message}`);
                }

                // Test 3: Create Department
                console.log('\n3Ô∏è‚É£ Testing Department.tsx Create Department');
                let testDeptId = null;
                try {
                    const createUrl = `${API_BASE_URL}/enterprise/${ENTERPRISE_ID}/departments`;
                    console.log(`   ‚Üí POST ${createUrl}`);
                    
                    const createResponse = await fetch(createUrl, {
                        method: 'POST',
                        headers,
                        body: JSON.stringify({
                            name: "Quick Test Dept",
                            description: "Created by quick test",
                            managers: []
                        })
                    });
                    
                    const createData = await createResponse.json();
                    testDeptId = createData.department?.id;
                    
                    console.log(`   ‚úÖ Status: ${createResponse.status}`);
                    console.log(`   üÜî Created: ${testDeptId}`);
                } catch (error) {
                    console.log(`   ‚ùå Error: ${error.message}`);
                }

                // Test 4: Delete Department
                if (testDeptId) {
                    console.log('\n4Ô∏è‚É£ Testing Department.tsx Delete Department');
                    try {
                        const deleteUrl = `${API_BASE_URL}/enterprise/${ENTERPRISE_ID}/departments/${testDeptId}`;
                        console.log(`   ‚Üí DELETE ${deleteUrl}`);
                        
                        const deleteResponse = await fetch(deleteUrl, {
                            method: 'DELETE',
                            headers
                        });
                        
                        console.log(`   ‚úÖ Status: ${deleteResponse.status}`);
                        console.log(`   üóëÔ∏è Deleted: ${testDeptId}`);
                    } catch (error) {
                        console.log(`   ‚ùå Error: ${error.message}`);
                    }
                }

                console.log('\nüéØ Quick Test Complete!');
                console.log('üí° If all status codes are 200-299, your Department.tsx should work!');

                statusEl.className = 'status success';
                statusEl.textContent = '‚úÖ Quick Test Completed Successfully!';

            } catch (error) {
                console.error('üí• Quick test failed:', error);
                statusEl.className = 'status error';
                statusEl.textContent = '‚ùå Quick Test Failed - Check console for details';
            } finally {
                restoreConsole();
                btn.disabled = false;
            }
        }

        // Comprehensive Test
        async function runComprehensiveTest() {
            const statusEl = document.getElementById('comprehensiveTestStatus');
            const outputEl = document.getElementById('comprehensiveTestOutput');
            const btn = document.getElementById('comprehensiveTestBtn');

            statusEl.className = 'status running';
            statusEl.textContent = 'üîÑ Running Comprehensive Test...';
            outputEl.style.display = 'block';
            outputEl.textContent = '';
            btn.disabled = true;

            const restoreConsole = captureConsole(outputEl);

            try {
                // Load and run the robust comprehensive test script
                const response = await fetch('/src/test-department-comprehensive-robust.js');
                const scriptContent = await response.text();
                
                // Execute the script
                eval(scriptContent);
                
                statusEl.className = 'status success';
                statusEl.textContent = '‚úÖ Comprehensive Test Completed Successfully!';

            } catch (error) {
                console.error('üí• Comprehensive test failed:', error);
                statusEl.className = 'status error';
                statusEl.textContent = '‚ùå Comprehensive Test Failed - Check console for details';
            } finally {
                restoreConsole();
                btn.disabled = false;
            }
        }

        // Manual Tests
        async function testGetDepartments() {
            const outputEl = document.getElementById('manualTestOutput');
            outputEl.style.display = 'block';
            outputEl.textContent = '';

            const restoreConsole = captureConsole(outputEl);

            try {
                const headers = {
                    'Authorization': `Bearer ${FIREBASE_TOKEN}`,
                    'Content-Type': 'application/json'
                };

                console.log('üß™ Manual Test: Get Departments');
                const url = `${API_BASE_URL}/enterprise/${ENTERPRISE_ID}/departments`;
                console.log(`URL: ${url}`);
                
                const response = await fetch(url, { headers });
                const data = await response.json();
                
                console.log(`Status: ${response.status}`);
                console.log('Response:', data);
            } catch (error) {
                console.error('Error:', error);
            } finally {
                restoreConsole();
            }
        }

        async function testGetCards() {
            const outputEl = document.getElementById('manualTestOutput');
            outputEl.style.display = 'block';
            outputEl.textContent = '';

            const restoreConsole = captureConsole(outputEl);

            try {
                const headers = {
                    'Authorization': `Bearer ${FIREBASE_TOKEN}`,
                    'Content-Type': 'application/json'
                };

                console.log('üß™ Manual Test: Get Cards');
                const url = `${API_BASE_URL}/enterprise/${ENTERPRISE_ID}/cards`;
                console.log(`URL: ${url}`);
                
                const response = await fetch(url, { headers });
                const data = await response.json();
                
                console.log(`Status: ${response.status}`);
                console.log('Response:', data);
            } catch (error) {
                console.error('Error:', error);
            } finally {
                restoreConsole();
            }
        }

        async function testCreateDepartment() {
            const outputEl = document.getElementById('manualTestOutput');
            outputEl.style.display = 'block';
            outputEl.textContent = '';

            const restoreConsole = captureConsole(outputEl);

            try {
                const headers = {
                    'Authorization': `Bearer ${FIREBASE_TOKEN}`,
                    'Content-Type': 'application/json'
                };

                console.log('üß™ Manual Test: Create Department');
                const url = `${API_BASE_URL}/enterprise/${ENTERPRISE_ID}/departments`;
                console.log(`URL: ${url}`);
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers,
                    body: JSON.stringify({
                        name: "Manual Test Dept",
                        description: "Created by manual test",
                        managers: []
                    })
                });
                
                const data = await response.json();
                
                console.log(`Status: ${response.status}`);
                console.log('Response:', data);
            } catch (error) {
                console.error('Error:', error);
            } finally {
                restoreConsole();
            }
        }

        async function testEmployeeFix() {
            const outputEl = document.getElementById('manualTestOutput');
            outputEl.style.display = 'block';
            outputEl.textContent = '';

            const restoreConsole = captureConsole(outputEl);

            try {
                // Load and run the employee fix test
                const response = await fetch('/src/test-employee-fix.js');
                const scriptContent = await response.text();
                
                // Execute the script
                eval(scriptContent);
            } catch (error) {
                console.error('Error:', error);
            } finally {
                restoreConsole();
            }
        }

        async function testDeleteDepartment() {
            const outputEl = document.getElementById('manualTestOutput');
            outputEl.style.display = 'block';
            outputEl.textContent = '';

            const restoreConsole = captureConsole(outputEl);

            try {
                const departmentId = prompt("Enter Department ID to delete:");
                if (!departmentId) {
                    console.log('‚ùå No department ID provided.');
                    return;
                }

                // Always use FIREBASE_TOKEN from api.ts
                let token = FIREBASE_TOKEN;
                if (!token.startsWith('Bearer ')) {
                    token = 'Bearer ' + token;
                }

                const headers = {
                    'Authorization': token,
                    'Content-Type': 'application/json'
                };

                const url = `${API_BASE_URL}/enterprise/${ENTERPRISE_ID}/departments/${departmentId}`;
                console.log('üß™ Manual Test: Delete Department');
                console.log(`URL: ${url}`);

                const response = await fetch(url, {
                    method: 'DELETE',
                    headers
                });

                const data = await response.json().catch(() => ({}));
                console.log(`Status: ${response.status}`);
                console.log('Response:', data);

                if (response.ok) {
                    console.log('‚úÖ Department deleted successfully.');
                } else {
                    console.log('‚ùå Failed to delete department.');
                }
            } catch (error) {
                console.error('Error:', error);
            } finally {
                restoreConsole();
            }
        }

        async function listAllDepartments() {
            const outputEl = document.getElementById('manualTestOutput');
            outputEl.style.display = 'block';
            outputEl.textContent = '';

            const restoreConsole = captureConsole(outputEl);

            try {
                // Always use FIREBASE_TOKEN from api.ts
                let token = FIREBASE_TOKEN;
                if (!token.startsWith('Bearer ')) {
                    token = 'Bearer ' + token;
                }

                const headers = {
                    'Authorization': token,
                    'Content-Type': 'application/json'
                };

                const url = `${API_BASE_URL}/enterprise/${ENTERPRISE_ID}/departments`;
                console.log('üß™ Listing All Department IDs');
                console.log(`URL: ${url}`);

                const response = await fetch(url, { headers });
                const data = await response.json();
                
                console.log(`Status: ${response.status}`);
                
                if (response.ok && data.departments && data.departments.length > 0) {
                    console.log('üìã Available Departments:');
                    data.departments.forEach((dept, index) => {
                        console.log(`${index + 1}. ID: ${dept.id} | Name: ${dept.name}`);
                    });
                } else {
                    console.log('No departments found or error fetching departments.');
                    console.log('Response:', data);
                }
            } catch (error) {
                console.error('Error:', error);
            } finally {
                restoreConsole();
            }
        }

        async function listEmployeesInDepartment() {
            const outputEl = document.getElementById('manualTestOutput');
            outputEl.style.display = 'block';
            outputEl.textContent = '';

            const restoreConsole = captureConsole(outputEl);

            try {
                const departmentId = prompt("Enter Department ID to list employees:");
                if (!departmentId) {
                    console.log('‚ùå No department ID provided.');
                    return;
                }
                let token = FIREBASE_TOKEN;
                if (!token.startsWith('Bearer ')) {
                    token = 'Bearer ' + token;
                }
                const headers = {
                    'Authorization': token,
                    'Content-Type': 'application/json'
                };
                const url = `${API_BASE_URL}/enterprise/${ENTERPRISE_ID}/departments/${departmentId}/employees`;
                console.log('üß™ Listing Employees in Department');
                console.log(`URL: ${url}`);
                const response = await fetch(url, { headers });
                const data = await response.json();
                console.log(`Status: ${response.status}`);
                if (response.ok && data.employees && Object.keys(data.employees).length > 0) {
                    console.log('üìã Employees:');
                    Object.values(data.employees).forEach((emp, idx) => {
                        console.log(`${idx + 1}. ID: ${emp.id || emp._id} | Name: ${emp.name || (emp.firstName + ' ' + emp.lastName)}`);
                    });
                } else {
                    console.log('No employees found or error fetching employees.');
                    console.log('Response:', data);
                }
            } catch (error) {
                console.error('Error:', error);
            } finally {
                restoreConsole();
            }
        }

        async function removeAllEmployeesFromDepartment() {
            const outputEl = document.getElementById('manualTestOutput');
            outputEl.style.display = 'block';
            outputEl.textContent = '';

            const restoreConsole = captureConsole(outputEl);

            try {
                const departmentId = prompt("Enter Department ID to remove all employees:");
                if (!departmentId) {
                    console.log('‚ùå No department ID provided.');
                    return;
                }
                // WARNING
                console.log('‚ö†Ô∏è WARNING: This will REMOVE ALL EMPLOYEES from the department!');
                console.log('‚ö†Ô∏è This action is IRREVERSIBLE and for testing/demo only!');
                const confirmRemove = confirm("Are you sure you want to remove ALL employees from this department? This cannot be undone.");
                if (!confirmRemove) {
                    console.log('‚ùå Operation cancelled by user.');
                    return;
                }
                let token = FIREBASE_TOKEN;
                if (!token.startsWith('Bearer ')) {
                    token = 'Bearer ' + token;
                }
                const headers = {
                    'Authorization': token,
                    'Content-Type': 'application/json'
                };
                const url = `${API_BASE_URL}/enterprise/${ENTERPRISE_ID}/departments/${departmentId}/employees`;
                // Get employees first
                const response = await fetch(url, { headers });
                const data = await response.json();
                if (!response.ok || !data.employees || Object.keys(data.employees).length === 0) {
                    console.log('No employees found or error fetching employees.');
                    console.log('Response:', data);
                    return;
                }
                const employees = Object.values(data.employees);
                let successCount = 0;
                let failCount = 0;
                for (const emp of employees) {
                    const empId = emp.id || emp._id;
                    if (!empId) continue;
                    // Try to delete employee
                    const delUrl = `${API_BASE_URL}/enterprise/${ENTERPRISE_ID}/employees/${empId}`;
                    const delResp = await fetch(delUrl, { method: 'DELETE', headers });
                    if (delResp.ok) {
                        console.log(`‚úÖ Removed employee: ${empId}`);
                        successCount++;
                    } else {
                        const delData = await delResp.json().catch(() => ({}));
                        console.log(`‚ùå Failed to remove employee: ${empId}`, delData);
                        failCount++;
                    }
                }
                console.log(`
‚ö†Ô∏è Remove All Employees Complete. Success: ${successCount}, Failed: ${failCount}`);
            } catch (error) {
                console.error('Error:', error);
            } finally {
                restoreConsole();
            }
        }

        async function unassignAllEmployeesFromDepartment() {
            const outputEl = document.getElementById('manualTestOutput');
            outputEl.style.display = 'block';
            outputEl.textContent = '';

            const restoreConsole = captureConsole(outputEl);

            try {
                const departmentId = prompt("Enter Department ID to unassign all employees:");
                if (!departmentId) {
                    console.log('‚ùå No department ID provided.');
                    return;
                }
                // WARNING
                console.log('‚ö†Ô∏è WARNING: This will UNASSIGN (not delete) ALL EMPLOYEES from the department!');
                console.log('‚ö†Ô∏è This action will set their departmentId to null.');
                const confirmRemove = confirm("Are you sure you want to unassign ALL employees from this department? This cannot be undone.");
                if (!confirmRemove) {
                    console.log('‚ùå Operation cancelled by user.');
                    return;
                }
                let token = FIREBASE_TOKEN;
                if (!token.startsWith('Bearer ')) {
                    token = 'Bearer ' + token;
                }
                const headers = {
                    'Authorization': token,
                    'Content-Type': 'application/json'
                };
                const url = `${API_BASE_URL}/enterprise/${ENTERPRISE_ID}/departments/${departmentId}/employees`;
                // Get employees first
                const response = await fetch(url, { headers });
                const data = await response.json();
                if (!response.ok || !data.employees || Object.keys(data.employees).length === 0) {
                    console.log('No employees found or error fetching employees.');
                    console.log('Response:', data);
                    return;
                }
                const employees = Object.values(data.employees);
                let successCount = 0;
                let failCount = 0;
                for (const emp of employees) {
                    const empId = emp.id || emp._id;
                    if (!empId) continue;
                    // Try to unassign employee (set departmentId to null)
                    const updateUrl = `${API_BASE_URL}/enterprise/${ENTERPRISE_ID}/departments/${departmentId}/employees/${empId}`;
                    const updateResp = await fetch(updateUrl, {
                        method: 'PUT',
                        headers,
                        body: JSON.stringify({ departmentId: null })
                    });
                    if (updateResp.ok) {
                        console.log(`‚úÖ Unassigned employee: ${empId}`);
                        successCount++;
                    } else {
                        const updateData = await updateResp.json().catch(() => ({}));
                        console.log(`‚ùå Failed to unassign employee: ${empId}`, updateData);
                        failCount++;
                    }
                }
                console.log(`\n‚ö†Ô∏è Unassign All Employees Complete. Success: ${successCount}, Failed: ${failCount}`);
            } catch (error) {
                console.error('Error:', error);
            } finally {
                restoreConsole();
            }
        }
    </script>
</body>
</html> 